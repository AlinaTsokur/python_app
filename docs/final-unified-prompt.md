# –£–ù–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–´–ô –ü–†–û–ú–ü–¢: –ê–õ–ì–û–†–ò–¢–ú –Ø–ö–û–†–ù–û–ô –¢–û–ß–ö–ò + ORDER FLOW V3.4

## üìã –°–¢–†–£–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PYTHON CORE ENGINE (Supabase + –†–∞—Å—á—ë—Ç—ã)                    ‚îÇ
‚îÇ  ‚îú‚îÄ –ú–æ–¥—É–ª—å 1: –ü–æ–∏—Å–∫ —è–∫–æ—Ä–Ω–æ–π —Ç–æ—á–∫–∏ (ANCHOR FINDER)          ‚îÇ
‚îÇ  ‚îú‚îÄ –ú–æ–¥—É–ª—å 2: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (STRUCTURE OVERRIDE)       ‚îÇ
‚îÇ  ‚îú‚îÄ –ú–æ–¥—É–ª—å 3: –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ—Ç–æ–∫–∞ (FLOW METRICS)                 ‚îÇ
‚îÇ  ‚îú‚îÄ –ú–æ–¥—É–ª—å 4: VETO-—Ñ–∏–ª—å—Ç—Ä—ã (WALL/ER/SR/GR1)                ‚îÇ
‚îÇ  ‚îî‚îÄ –ú–æ–¥—É–ª—å 5: TAM-V3.3 –∞–Ω–æ–º–∞–ª–∏–∏ (7 —Ñ–∏–ª—å—Ç—Ä–æ–≤)               ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  OUTPUT: JSON-–æ—Ç—á—ë—Ç —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  AI INTERPRETER (Claude/GPT)                                 ‚îÇ
‚îÇ  ‚îú‚îÄ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —è–∫–æ—Ä—è –∏ –ø–æ—Ç–æ–∫–∞                            ‚îÇ
‚îÇ  ‚îú‚îÄ –§–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ (–ò–ú–ü–£–õ–¨–°/–ö–£–õ–¨–ú–ò–ù–ê–¶–ò–Ø/–ë–ê–õ–ê–ù–°)            ‚îÇ
‚îÇ  ‚îú‚îÄ –°–∏–Ω—Ç–µ–∑ —Å —É—Ä–æ–≤–Ω—è–º–∏ (1-4)                                 ‚îÇ
‚îÇ  ‚îú‚îÄ –†–∏—Å–∫–∏ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏                                     ‚îÇ
‚îÇ  ‚îî‚îÄ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ + –ü–ª–∞–Ω —Ç–æ—Ä–≥–æ–≤–ª–∏                        ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  OUTPUT: –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π –æ—Ç—á—ë—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚öôÔ∏è –ß–ê–°–¢–¨ 1: PYTHON CORE ENGINE (–†–ê–°–ß–Å–¢–ù–ê–Ø –õ–û–ì–ò–ö–ê)

### 1.0. –ò–°–¢–û–ß–ù–ò–ö –î–ê–ù–ù–´–•: SUPABASE

**–¢–∞–±–ª–∏—Ü–∞:** `candles`  
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```sql
CREATE TABLE candles (
  id UUID PRIMARY KEY,
  ts TIMESTAMPTZ NOT NULL,
  tf VARCHAR(10) NOT NULL,           -- '1D', 'H4', '4h', 'H1', '1h', 'M30', 'M15', 'M5', 'M1'
  symbol_clean VARCHAR(20) NOT NULL, -- 'ETHUSDT', 'BTCUSDT'
  exchange VARCHAR(20),              -- 'binance', 'bybit'
  
  -- –¶–µ–Ω–∞ (8 –ø–æ–ª–µ–π)
  open NUMERIC,
  high NUMERIC,
  low NUMERIC,
  close NUMERIC,
  range NUMERIC,
  body NUMERIC,
  clv_pct NUMERIC,
  price_sign INT, -- +1/0/-1
  
  -- –û–±—ä—ë–º (5 –ø–æ–ª–µ–π)
  volume NUMERIC,
  delta NUMERIC,
  delta_pct NUMERIC,
  imbalance_pct NUMERIC,
  trades_count INT,
  
  -- –ü–æ—Ç–æ–∫ (8 –ø–æ–ª–µ–π)
  cvd_pct NUMERIC,
  cvd_small NUMERIC,
  dtrades_pct NUMERIC,
  trades_buy INT,
  trades_sell INT,
  price_vs_delta VARCHAR(10), -- 'match' / 'div'
  delta_buy NUMERIC,
  delta_sell NUMERIC,
  
  -- OI (11 –ø–æ–ª–µ–π)
  oi_set BOOLEAN,
  oi_counter BOOLEAN,
  oi_unload BOOLEAN,
  oi_in_sens BOOLEAN,
  oi_path VARCHAR(10), -- 'up' / 'down' / 'flat'
  doi_pct NUMERIC,
  oi_long NUMERIC,
  oi_short NUMERIC,
  oi_total NUMERIC,
  oi_change NUMERIC,
  oi_level VARCHAR(20),
  
  -- –õ–∏–∫–≤–∏–¥–∞—Ü–∏–∏ (5 –ø–æ–ª–µ–π)
  liq_long NUMERIC,
  liq_short NUMERIC,
  limb_pct NUMERIC,
  liqshare_pct NUMERIC,
  liq_squeeze BOOLEAN,
  
  -- –ì–µ–æ–º–µ—Ç—Ä–∏—è (10 –ø–æ–ª–µ–π)
  body_pct NUMERIC,
  upper_tail_pct NUMERIC,
  lower_tail_pct NUMERIC,
  dominant_reject VARCHAR(10),
  range_pct NUMERIC,
  tilt_pct NUMERIC,
  ratio_stable NUMERIC,
  
  -- –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ
  er NUMERIC, -- Efficiency Ratio (range / |cvd|)
  sr NUMERIC, -- Sustainability Ratio (doi / range)
  oe NUMERIC, -- Order Efficiency (body / |cvd|)
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–º–µ—Ç–∫–∏
  note TEXT
);

-- –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è upsert
CREATE UNIQUE INDEX idx_candles_upsert ON candles(exchange, symbol_clean, tf, ts);
CREATE INDEX idx_candles_symbol_tf_ts ON candles(symbol_clean, tf, ts);
```

**–ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö:**
```python
def fetch_candles(symbol: str, exchange: str, start_ts: str, end_ts: str, 
                  limit: int = 500) -> List[Dict]:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ—á–µ–π –∏–∑ Supabase –∑–∞ –ø–µ—Ä–∏–æ–¥.
    
    –ö–†–ò–¢–ò–ß–ù–û:
    - exchange –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–º–µ—à–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–Ω—ã—Ö –±–∏—Ä–∂
    - —Å–≤–µ—á–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã—Ö TF (1D, H4, H1 –∏ —Ç.–¥.)
    - limit –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –°–ú–ï–®–ê–ù–ù–û–ú–£ —Å–ø–∏—Å–∫—É ‚Äî —Å—Ç–∞–≤–∏—Ç—å —Å –∑–∞–ø–∞—Å–æ–º!
    
    –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è final_tf –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å
    —É–∂–µ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ tf –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π.
    
    Args:
        symbol: –¢–∏–∫–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'ETHUSDT')
        exchange: –ë–∏—Ä–∂–∞ ('binance', 'bybit') ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
        start_ts: –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ (ISO8601 UTC)
        end_ts: –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (ISO8601 UTC)
        limit: –ú–∞–∫—Å–∏–º—É–º —Å–≤–µ—á–µ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 500+ –¥–ª—è —Å–º–µ—à–∞–Ω–Ω—ã—Ö TF)
    
    Returns:
        List[Dict]: –°–≤–µ—á–∏ –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ, –ø–æ–ª–µ 'tf' —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–∞–π–º—Ñ—Ä–µ–π–º.
    """
    response = supabase.table('candles') \
        .select('*') \
        .eq('exchange', exchange) \
        .eq('symbol_clean', symbol) \
        .gte('ts', start_ts) \
        .lte('ts', end_ts) \
        .order('ts', desc=False) \
        .limit(limit) \
        .execute()
    
    return response.data
```

---

### 1.1. –ú–û–î–£–õ–¨ –ü–û–ò–°–ö–ê –Ø–ö–û–†–Ø (ANCHOR FINDER)

**–í–•–û–î:** `List[Dict]` ‚Äî —Å–≤–µ—á–∏ –∏–∑ Supabase (50-300 —à—Ç)  
**–í–´–•–û–î:** `Dict` ‚Äî —è–∫–æ—Ä—å T0 –∏–ª–∏ None

#### 1.1.1. –≠–¢–ê–ü SCAN: –ü–æ–∏—Å–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

```python
def scan_candidates(candles: List[Dict]) -> List[Dict]:
    """
    –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–µ—á–µ–π –Ω–∞ —Å–æ–±—ã—Ç–∏—è-–∫–∞–Ω–¥–∏–¥–∞—Ç—ã.
    
    ‚ÑπÔ∏è –í unified workflow —Å—é–¥–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å–≤–µ—á–∏ –£–ñ–ï –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ final_tf.
    TF —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ candle['tf'] –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è.
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ —Å –ø–æ–ª—è–º–∏:
        - index: –Ω–æ–º–µ—Ä —Å–≤–µ—á–∏ –≤ –º–∞—Å—Å–∏–≤–µ
        - type: 'A' | 'B' | 'C'
        - side: 'LONG' | 'SHORT'
        - price: —Ü–µ–Ω–∞ —è–∫–æ—Ä—è
        - timestamp: –≤—Ä–µ–º—è —Å–≤–µ—á–∏
        - tf: —Ç–∞–π–º—Ñ—Ä–µ–π–º —Å–≤–µ—á–∏
    """
    candidates = []
    
    for i in range(len(candles)):
        candle = candles[i]
        # –í–ê–ñ–ù–û: –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º TF –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–π —Å –ø–æ—Ä–æ–≥–∞–º–∏!
        c_tf = _normalize_tf(candle.get('tf') or candle.get('timeframe'))
        
        # === TYPE A: –°–ª–æ–º OI ===
        # side –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ù–ï –ø–æ –∑–Ω–∞–∫—É doi, –∞ –ø–æ —Ä–∞–∑–≤–æ—Ä–æ—Ç—É —Ü–µ–Ω—ã –ø–æ—Å–ª–µ —Å–≤–µ—á–∏ i
        if abs(candle.get('doi_pct') or 0) > 5.0:
            side = None
            
            # –ò—â–µ–º –ø–æ—Å–ª–µ i –æ—Ç–∫–∞—Ç/—Ä–∞–∑–≤–æ—Ä–æ—Ç >5% –≤ –ª—é–±—É—é —Å—Ç–æ—Ä–æ–Ω—É –æ—Ç close[i]
            base = candle.get('close')
            if base is None or base == 0:
                continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–≤–µ—á–∏ –±–µ–∑ —Ü–µ–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è
            
            future_candles = candles[i+1:]
            
            if future_candles:
                max_after = max((c.get('high') or 0) for c in future_candles)
                min_after = min((c.get('low') or float('inf')) for c in future_candles)
                
                up_move = (max_after - base) / base * 100
                down_move = (base - min_after) / base * 100
                
                if up_move > 5.0 and up_move >= down_move:
                    side = 'LONG'
                elif down_move > 5.0 and down_move > up_move:
                    side = 'SHORT'
            
            # –ï—Å–ª–∏ side –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª—Å—è ‚Äî –∫–∞–Ω–¥–∏–¥–∞—Ç TYPE A –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º
            if side is not None:
                candidates.append({
                    'index': i,
                    'type': 'A',
                    'side': side,
                    'price': candle['close'],
                    'timestamp': candle['ts'],
                    'high': candle['high'],
                    'low': candle['low'],
                    'tf': c_tf
                })
        
        # === TYPE B: –°–ª–æ–º —Ü–µ–Ω—ã + –æ—Ç–∫–∞—Ç ===
        # –ë–ï–ó –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è 10 —Å–≤–µ—á–µ–π ‚Äî –∏—â–µ–º –æ—Ç–∫–∞—Ç –¥–æ –∫–æ–Ω—Ü–∞ –º–∞—Å—Å–∏–≤–∞
        if i > 0 and i < len(candles) - 1:
            prev_highs = [c['high'] for c in candles[:i]]
            prev_lows = [c['low'] for c in candles[:i]]
            
            is_new_high = candle['high'] > max(prev_highs) if prev_highs else False
            is_new_low = candle['low'] < min(prev_lows) if prev_lows else False
            
            # –ü—Ä–æ–±–æ–π –≤–≤–µ—Ä—Ö ‚Üí –∏—â–µ–º –æ—Ç–∫–∞—Ç –≤–Ω–∏–∑ >5%
            if is_new_high:
                for j in range(i+1, len(candles)):  # –ë–ï–ó min(i+10, ...)
                    retracement = (candle['high'] - candles[j]['close']) / candle['high'] * 100
                    if retracement > 5.0:
                        candidates.append({
                            'index': i,
                            'type': 'B',
                            'side': 'SHORT',
                            'price': candle['high'],
                            'timestamp': candle['ts'],
                            'high': candle['high'],
                            'low': candle['low'],
                            'tf': c_tf
                        })
                        break
            
            # –ü—Ä–æ–±–æ–π –≤–Ω–∏–∑ ‚Üí –∏—â–µ–º –æ—Ç–∫–∞—Ç –≤–≤–µ—Ä—Ö >5%
            if is_new_low:
                for j in range(i+1, len(candles)):  # –ë–ï–ó min(i+10, ...)
                    retracement = (candles[j]['close'] - candle['low']) / candle['low'] * 100
                    if retracement > 5.0:
                        candidates.append({
                            'index': i,
                            'type': 'B',
                            'side': 'LONG',
                            'price': candle['low'],
                            'timestamp': candle['ts'],
                            'high': candle['high'],
                            'low': candle['low'],
                            'tf': c_tf
                        })
                        break
        
        # === TYPE C: –ö—É–ª—å–º–∏–Ω–∞—Ü–∏—è CVD + –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π —Ä–∞–∑–≤–æ—Ä–æ—Ç —Ü–µ–Ω—ã >5% ===
        # –ü–æ—Ä–æ–≥ CVD –∑–∞–≤–∏—Å–∏—Ç –æ—Ç TF (c_tf —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ _normalize_tf)
        cvd_threshold = 5.0 if c_tf == '1D' else 15.0 if c_tf == 'H4' else None
        
        if cvd_threshold is not None and abs(candle.get('cvd_pct') or 0) > cvd_threshold:
            if i < len(candles) - 1:
                base = candle['close']
                future_candles = candles[i+1:]
                
                max_after = max(c['high'] for c in future_candles)
                min_after = min(c['low'] for c in future_candles)
                
                up_move = (max_after - base) / base * 100
                down_move = (base - min_after) / base * 100
                
                # –ö—É–ª—å–º–∏–Ω–∞—Ü–∏—è BUY (cvd > 0), –∂–¥—ë–º —Ä–∞–∑–≤–æ—Ä–æ—Ç –≤–Ω–∏–∑ >5% ‚Üí SHORT
                if candle['cvd_pct'] > 0 and down_move > 5.0:
                    candidates.append({
                        'index': i,
                        'type': 'C',
                        'side': 'SHORT',
                        'price': candle['close'],
                        'timestamp': candle['ts'],
                        'high': candle['high'],
                        'low': candle['low'],
                        'tf': c_tf
                    })
                
                # –ö—É–ª—å–º–∏–Ω–∞—Ü–∏—è SELL (cvd < 0), –∂–¥—ë–º —Ä–∞–∑–≤–æ—Ä–æ—Ç –≤–≤–µ—Ä—Ö >5% ‚Üí LONG
                if candle['cvd_pct'] < 0 and up_move > 5.0:
                    candidates.append({
                        'index': i,
                        'type': 'C',
                        'side': 'LONG',
                        'price': candle['close'],
                        'timestamp': candle['ts'],
                        'high': candle['high'],
                        'low': candle['low'],
                        'tf': c_tf
                    })
    
    return candidates
```

#### 1.1.2. –≠–¢–ê–ü SELECT: –í—ã–±–æ—Ä –≤–∞–ª–∏–¥–Ω–æ–≥–æ —è–∫–æ—Ä—è

```python
def select_anchor(candidates: List[Dict], candles: List[Dict]) -> Optional[Dict]:
    """
    –í—ã–±–æ—Ä –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —è–∫–æ—Ä—è –∏–∑ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤.
    
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
        1. Overlap (–ø—Ä–æ–±–∏—Ç–∞ –ª–∏ —Ü–µ–Ω–∞ —è–∫–æ—Ä—è)
        2. OI Reset (Net OI –ø–æ—Å–ª–µ —è–∫–æ—Ä—è <= 0)
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π –≤–∞–ª–∏–¥–Ω—ã–π —è–∫–æ—Ä—å (—Å –∫–æ–Ω—Ü–∞ —Å–ø–∏—Å–∫–∞).
    """
    # –ò–¥—ë–º —Å –∫–æ–Ω—Ü–∞ (—Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã)
    for cand in reversed(candidates):
        t0_index = cand['index']
        side = cand['side']
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Overlap
        is_overlapped = False
        for i in range(t0_index + 1, len(candles)):
            close = candles[i]['close']
            if side == 'SHORT' and close > cand['high']:
                is_overlapped = True
                break
            if side == 'LONG' and close < cand['low']:
                is_overlapped = True
                break
        
        if is_overlapped:
            continue  # –Ø–∫–æ—Ä—å –ø—Ä–æ–±–∏—Ç, –∏—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: OI Reset
        # –í–ê–ñ–ù–û: Net OI —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç T0 –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–æ –∫–æ–Ω—Ü–∞ (–Ω–µ –æ—Ç t0+1)
        net_oi = sum((candles[i].get('oi_change') or 0) for i in range(t0_index, len(candles)))
        
        if net_oi <= 0:
            continue  # –ü–æ–∑–∏—Ü–∏–∏ –æ–±–Ω—É–ª–µ–Ω—ã
        
        # –Ø–∫–æ—Ä—å –≤–∞–ª–∏–¥–µ–Ω!
        return cand
    
    return None  # –ù–µ –Ω–∞—à–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–π —è–∫–æ—Ä—å
```

---

### 1.2. –ú–û–î–£–õ–¨ –°–¢–†–£–ö–¢–£–†–ù–û–ì–û –°–õ–û–ú–ê (STRUCTURE OVERRIDE)

**–í–•–û–î:** –Ø–∫–æ—Ä—å T0 + –∏—Å—Ç–æ—Ä–∏—è —Å–≤–µ—á–µ–π  
**–í–´–•–û–î:** T_struct (–∏–Ω–¥–µ–∫—Å —Å–ª–æ–º–∞) –∏–ª–∏ None

#### 1.2.1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Å–ª–æ–º–∞

```python
def find_structural_break(candles: List[Dict], anchor: Dict, tf: str) -> Optional[int]:
    """
    –ü–æ–∏—Å–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Å–ª–æ–º–∞ –ù–ê–ó–ê–î –æ—Ç —è–∫–æ—Ä—è.
    
    Args:
        candles: –º–∞—Å—Å–∏–≤ —Å–≤–µ—á–µ–π
        anchor: —è–∫–æ—Ä—å T0
        tf: —Ç–∞–π–º—Ñ—Ä–µ–π–º ('1D', 'H4', etc.)
    
    Returns:
        index –ø–µ—Ä–≤–æ–π —Å–≤–µ—á–∏ —Å–ª–æ–º–∞ –∏–ª–∏ None
    """
    t0_index = anchor['index']
    side = anchor['side']
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä –æ–∫–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    # H4 = 30 (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ), 1D = 20, 1W = 8
    L_struct = 20 if tf == '1D' else 8 if tf == '1W' else 30
    
    # –ò–¥—ë–º –Ω–∞–∑–∞–¥ –æ—Ç T0-1
    for k in range(t0_index - 1, L_struct, -1):
        # –í—ã—á–∏—Å–ª—è–µ–º —É—Ä–æ–≤–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        window = candles[k - L_struct:k]
        S_high = max(c['high'] for c in window)
        S_low = min(c['low'] for c in window)
        
        candle_k = candles[k]
        candle_k1 = candles[k + 1]
        
        # Bullish Break (–∏—â–µ–º –µ—Å–ª–∏ side=LONG)
        if side == 'LONG':
            # –¢–µ–ª–æ —Å–≤–µ—á–∏ k –≤—ã—à–µ S_high
            if min(candle_k['open'], candle_k['close']) > S_high:
                # –¢–µ–ª–æ —Å–≤–µ—á–∏ k+1 —Ç–æ–∂–µ –≤—ã—à–µ S_high
                if min(candle_k1['open'], candle_k1['close']) > S_high:
                    return k  # –ù–∞—à–ª–∏ —Å–ª–æ–º!
        
        # Bearish Break (–∏—â–µ–º –µ—Å–ª–∏ side=SHORT)
        if side == 'SHORT':
            # –¢–µ–ª–æ —Å–≤–µ—á–∏ k –Ω–∏–∂–µ S_low
            if max(candle_k['open'], candle_k['close']) < S_low:
                # –¢–µ–ª–æ —Å–≤–µ—á–∏ k+1 —Ç–æ–∂–µ –Ω–∏–∂–µ S_low
                if max(candle_k1['open'], candle_k1['close']) < S_low:
                    return k  # –ù–∞—à–ª–∏ —Å–ª–æ–º!
    
    return None  # –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω
```

---

### 1.3. –ú–û–î–£–õ–¨ –ú–ï–¢–†–ò–ö –ü–û–¢–û–ö–ê (FLOW METRICS)

**–í–•–û–î:** T_flow (–Ω–∞—á–∞–ª–æ –ø–æ—Ç–æ–∫–∞), —Å–≤–µ—á–∏ –¥–æ Tn  
**–í–´–•–û–î:** Dict —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏

```python
def calculate_flow_metrics(candles: List[Dict], t_flow: int, t_current: int) -> Dict:
    """
    –†–∞—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫ –ø–æ—Ç–æ–∫–∞ –Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [T_flow .. T_current].
    
    –í–ê–ñ–ù–û: NULL-safe! –í—Å–µ –ø–æ–ª—è –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ None.
    
    Returns:
        {
            'net_oi': float,       # –ß–∏—Å—Ç—ã–π OI (–∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
            'net_oi_pct': float,   # –ß–∏—Å—Ç—ã–π OI –≤ % –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ OI
            'cum_cvd': float,      # –ö—É–º—É–ª—è—Ç–∏–≤–Ω—ã–π CVD
            'avg_entry': float,    # –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞
            'current_price': float,
            'pl_percent': float    # P&L –ø–æ–∑–∏—Ü–∏–π
        }
    """
    flow_segment = candles[t_flow:t_current + 1]
    
    if not flow_segment:
        return {
            'net_oi': 0, 'net_oi_pct': None, 'cum_cvd': 0,
            'avg_entry': None, 'current_price': None, 'pl_percent': None
        }
    
    # 1. Net OI (–∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ) ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç NULL
    net_oi = sum((c.get('oi_change') or 0) for c in flow_segment)
    
    # 2. Net OI –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ OI
    oi_base = flow_segment[0].get('oi_total')
    net_oi_pct = (net_oi / oi_base * 100) if oi_base and oi_base != 0 else None
    
    # 3. Cum CVD ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç NULL
    cum_cvd = sum((c.get('cvd_pct') or 0) for c in flow_segment)
    
    # 4. Avg Entry (—Ç–æ–ª—å–∫–æ —Å–≤–µ—á–∏ —Å –Ω–∞–±–æ—Ä–æ–º OI)
    weighted_sum = 0.0
    total_weight = 0.0
    
    for c in flow_segment:
        oi_change = c.get('oi_change') or 0
        if oi_change > 0:
            close_price = c.get('close') or 0
            weighted_sum += close_price * oi_change
            total_weight += oi_change
    
    avg_entry = weighted_sum / total_weight if total_weight > 0 else candles[t_flow].get('close')
    
    # 5. Current Price
    current_price = candles[t_current].get('close')
    
    # 6. P&L ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 0
    pl_percent = None
    if avg_entry and avg_entry != 0 and current_price:
        pl_percent = ((current_price - avg_entry) / avg_entry) * 100
    
    return {
        'net_oi': net_oi,
        'net_oi_pct': round(net_oi_pct, 2) if net_oi_pct is not None else None,
        'cum_cvd': round(cum_cvd, 2),
        'avg_entry': avg_entry,
        'current_price': current_price,
        'pl_percent': round(pl_percent, 2) if pl_percent is not None else None
    }
```

---

### 1.4. –ú–û–î–£–õ–¨ –ò–ù–í–ê–õ–ò–î–ê–¶–ò–ò –ü–û–¢–û–ö–ê (FLOW INVALIDATION)

**–í–•–û–î:** T_flow, —è–∫–æ—Ä—å, —Å–≤–µ—á–∏  
**–í–´–•–û–î:** Status ('ACTIVE', 'STRUCT_BROKEN', 'OI_INVALIDATED')

```python
def check_flow_invalidation(candles: List[Dict], anchor: Dict, t_flow: int, tf: str) -> Dict:
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–∞.
    
    Returns:
        {
            'status': str,        # 'ACTIVE' | 'STRUCT_BROKEN' | 'OI_INVALIDATED'
            'reason': str,        # –ü—Ä–∏—á–∏–Ω–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
            'candle_index': int   # –ù–∞ –∫–∞–∫–æ–π —Å–≤–µ—á–µ —Å–ª–æ–º–∞–ª—Å—è
        }
    """
    side = anchor['side']
    # H4 = 30 (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ), 1D = 20, 1W = 8
    L_struct = 20 if tf == '1D' else 8 if tf == '1W' else 30
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –û–±—Ä–∞—Ç–Ω—ã–π —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–º
    for k in range(t_flow + 1, len(candles) - 1):
        window = candles[max(0, k - L_struct):k]
        S_high = max(c['high'] for c in window)
        S_low = min(c['low'] for c in window)
        
        candle_k = candles[k]
        candle_k1 = candles[k + 1]
        
        # –ï—Å–ª–∏ —è–∫–æ—Ä—å –±—ã–ª SHORT ‚Üí –∏—â–µ–º Bullish Break
        if side == 'SHORT':
            if min(candle_k['open'], candle_k['close']) > S_high and \
               min(candle_k1['open'], candle_k1['close']) > S_high:
                return {
                    'status': 'STRUCT_BROKEN',
                    'reason': '–û–±—Ä–∞—Ç–Ω—ã–π Bullish Break',
                    'candle_index': k
                }
        
        # –ï—Å–ª–∏ —è–∫–æ—Ä—å –±—ã–ª LONG ‚Üí –∏—â–µ–º Bearish Break
        if side == 'LONG':
            if max(candle_k['open'], candle_k['close']) < S_low and \
               max(candle_k1['open'], candle_k1['close']) < S_low:
                return {
                    'status': 'STRUCT_BROKEN',
                    'reason': '–û–±—Ä–∞—Ç–Ω—ã–π Bearish Break',
                    'candle_index': k
                }
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Net OI –æ–±–Ω—É–ª–∏–ª—Å—è ‚Äî NULL-safe!
    net_oi = sum((candles[i].get('oi_change') or 0) for i in range(t_flow, len(candles)))
    
    if net_oi <= 0:
        return {
            'status': 'OI_INVALIDATED',
            'reason': 'Net OI –æ–±–Ω—É–ª–∏–ª—Å—è',
            'candle_index': len(candles) - 1
        }
    
    # –ü–æ—Ç–æ–∫ –∞–∫—Ç–∏–≤–µ–Ω
    return {
        'status': 'ACTIVE',
        'reason': None,
        'candle_index': None
    }
```

---

### 1.5. –ú–û–î–£–õ–¨ VETO-–§–ò–õ–¨–¢–†–û–í (CORE ENGINE)

**–í–µ—Å—å –∫–æ–¥ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Ä–∞–∑–¥–µ–ª–∞ 8.1 ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π!**

```python
class V3_Deterministic_Core:
    def __init__(self, tf="H4"):
        self.tf = tf
        self.thresholds = {
            "1D":  {"sens": 0.90, "setup": 1.20, "counter": 1.40, "unload": -1.30, "div_min": 2.0},
            "H4":  {"sens": 0.45, "setup": 0.80, "counter": 1.00, "unload": -0.90, "div_min": 2.0},
            "H1":  {"sens": 0.30, "setup": 0.50, "counter": 0.60, "unload": -0.55, "div_min": 1.5},
        }.get(self.tf, {"sens": 0.30, "setup": 0.50, "counter": 0.60, "unload": -0.55, "div_min": 1.5})

    def run_analysis(self, candles):
        """
        –ó–∞–ø—É—Å–∫ VETO-—Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–≤–µ—á–µ.
        
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            {
                'veto': {'down': bool, 'up': bool, 'reasons': List[str]},
                'er': float,
                'sr': float,
                'oe': float
            }
        """
        # –ü–æ–ª–Ω—ã–π –∫–æ–¥ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 8.1 —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
        # [–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –¥–æ—Å–ª–æ–≤–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
```

---

### 1.6. –ú–û–î–£–õ–¨ TAM-V3.3 (7 –§–ò–õ–¨–¢–†–û–í –ê–ù–û–ú–ê–õ–ò–ô)

**–í–µ—Å—å –∫–æ–¥ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Ä–∞–∑–¥–µ–ª–∞ 12 ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π!**

```python
def detect_tam_anomalies(last_candle: Dict, baseline: Dict, tf: str) -> Dict:
    """
    –î–µ—Ç–µ–∫—Ü–∏—è –∞–Ω–æ–º–∞–ª–∏–π –ø–æ TAM-V3.3.
    
    Returns:
        {
            'friction': bool,
            'skew': bool,
            'fuel_inversion': bool,
            'quality': bool,
            'crowding': bool,
            'vacuum': bool,
            'hollow': bool,
            'details': Dict  # –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É
        }
    """
    # –ü–æ–ª–Ω—ã–π –∫–æ–¥ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 12 —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
    # [–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –¥–æ—Å–ª–æ–≤–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
```

---

### 1.7. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò

```python
def _normalize_tf(tf: str) -> str:
    """
    –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è TF –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É.
    
    '4h' -> 'H4', '4H' -> 'H4', '1d' -> '1D', etc.
    –í–∞–∂–Ω–æ: V3_Deterministic_Core.thresholds –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 'H4', 'H1', '1D'.
    """
    if not tf:
        return tf
    tf_lower = tf.strip().lower()  # –ü—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    mapping = {
        '4h': 'H4', '1h': 'H1', '30m': 'M30', '15m': 'M15', 
        '5m': 'M5', '1m': 'M1', '1d': '1D', '1w': '1W',
        'h4': 'H4', 'h1': 'H1', 'm30': 'M30', 'm15': 'M15',
    }
    # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ (—É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è)
    return mapping.get(tf_lower) or tf.strip().upper()


def _filter_by_tf(candles: List[Dict], target_tf: str) -> List[Dict]:
    """
    –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–≤–µ—á–µ–π –ø–æ –æ–¥–Ω–æ–º—É TF.
    
    –ö–†–ò–¢–ò–ß–ù–û: –≤—Å–µ —Ä–∞—Å—á—ë—Ç—ã (—è–∫–æ—Ä—å, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –º–µ—Ç—Ä–∏–∫–∏, VETO, TAM)
    –¥–æ–ª–∂–Ω—ã –¥–µ–ª–∞—Ç—å—Å—è –Ω–∞ —Å–≤–µ—á–∞—Ö –û–î–ù–û–ì–û TF, –∏–Ω–∞—á–µ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–∞.
    
    Args:
        candles: —Å–º–µ—à–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–≤–µ—á–µ–π
        target_tf: —Ü–µ–ª–µ–≤–æ–π TF (—É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π)
    
    Returns:
        –°–ø–∏—Å–æ–∫ —Å–≤–µ—á–µ–π —Ç–æ–ª—å–∫–æ —Ü–µ–ª–µ–≤–æ–≥–æ TF, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ ts
    """
    target_tf = _normalize_tf(target_tf)
    filtered = []
    for c in candles:
        c_tf = _normalize_tf(c.get('tf') or c.get('timeframe'))
        if c_tf == target_tf:
            filtered.append(c)
    # –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –ø–æ—Ä—è–¥–æ–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
    filtered.sort(key=lambda x: x.get('ts', ''))
    return filtered


def _pick_final_tf(candles: List[Dict]) -> Dict:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π TF –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
    
    –õ–æ–≥–∏–∫–∞:
    - –ï—Å–ª–∏ –µ—Å—Ç—å D1 –∏ H4: D1 –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç H4 –µ—Å–ª–∏ –∑–∞–∫—Ä—ã–ª–∞—Å—å >= –ø–æ—Å–ª–µ–¥–Ω–µ–π H4
    - –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ H4 ‚Äî –±–µ—Ä—ë–º H4
    - –ò–Ω–∞—á–µ ‚Äî —Å–∞–º—ã–π —Å—Ç–∞—Ä—à–∏–π TF –∏–∑ –∏–º–µ—é—â–∏—Ö—Å—è
    
    Returns:
        {'final_tf': 'H4'|'1D'|..., 'final_ts': timestamp}
        final_tf –≤—Å–µ–≥–¥–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω.
    """
    by_tf = {}
    for c in candles:
        tf = _normalize_tf(c.get('tf') or c.get('timeframe'))
        if not tf:
            continue
        by_tf.setdefault(tf, []).append(c)
    
    def _last_ts(tf_key: str):
        arr = by_tf.get(tf_key, [])
        if not arr:
            return None
        return max(x['ts'] for x in arr)
    
    ts_d1 = _last_ts('1D')
    ts_h4 = _last_ts('H4')
    
    if ts_d1 and ts_h4:
        # D1 –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç, –µ—Å–ª–∏ –∑–∞–∫—Ä—ã–ª–∞—Å—å –Ω–µ —Ä–∞–Ω—å—à–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π H4
        if ts_d1 >= ts_h4:
            return {'final_tf': '1D', 'final_ts': ts_d1}
        return {'final_tf': 'H4', 'final_ts': ts_h4}
    
    if ts_h4:
        return {'final_tf': 'H4', 'final_ts': ts_h4}
    
    # Fallback: –µ—Å–ª–∏ H4 –Ω–µ—Ç ‚Äî –±–µ—Ä—ë–º —Å–∞–º—ã–π —Å—Ç–∞—Ä—à–∏–π TF –∏–∑ –∏–º–µ—é—â–∏—Ö—Å—è –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏
    # –≠—Ç–æ—Ç priority –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤—ã—à–µ –Ω–µ –Ω–∞—à–ª–∏ D1/H4
    priority = ['1W', '1D', 'H4', 'H1', 'M30', 'M15', 'M5', 'M1']
    for p in priority:
        ts = _last_ts(p)
        if ts:
            return {'final_tf': p, 'final_ts': ts}
    
    return {'final_tf': None, 'final_ts': None}
```

---

### 1.8. –ú–û–î–£–õ–¨ –§–ê–ó–´ –ò –í–ï–†–û–Ø–¢–ù–û–°–¢–ò

**–í–ê–ñ–ù–û:** –í—Å–µ —Ä–∞—Å—á—ë—Ç—ã —Ñ–∞–∑—ã –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–µ–ª–∞—é—Ç—Å—è –≤ Python. AI —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

```python
def compute_phase(anchor: Dict, metrics: Dict, flow_status: str) -> Dict:
    """
    –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–∑—ã —Ä—ã–Ω–∫–∞ (IMPULS/KULMINACIA/BALANCE/INVALIDATED).
    
    ‚ö†Ô∏è –ü–û–†–û–ì–ò (–í–†–ï–ú–ï–ù–ù–´–ï, –¥–æ –≤—ã–Ω–µ—Å–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥ V3.x):
    - price_deviation > 5.0% + net_oi_pct < 5.0% ‚Üí KULMINACIA
    - price_deviation > 3.0% + net_oi_pct > 10.0% ‚Üí IMPULS
    - price_deviation < 2.0% + |net_oi_pct| < 3.0% ‚Üí BALANCE
    
    –°—á–∏—Ç–∞–µ—Ç—Å—è –ß–ê–°–¢–¨–Æ Python Core, –ù–ï AI-–ª–æ–≥–∏–∫–æ–π.
    """
    if flow_status != 'ACTIVE':
        return {
            'phase': 'INVALIDATED',
            'description': '–ü–æ—Ç–æ–∫ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω, —è–∫–æ—Ä—å –º—ë—Ä—Ç–≤',
            'confidence': 'HIGH'
        }
    
    anchor_price = anchor.get('price', 0)
    current_price = metrics.get('current_price', 0)
    net_oi_pct = metrics.get('net_oi_pct') or 0
    
    if anchor_price == 0:
        return {'phase': 'UNKNOWN', 'description': '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ü–µ–Ω–µ —è–∫–æ—Ä—è', 'confidence': 'LOW'}
    
    price_deviation = abs((current_price - anchor_price) / anchor_price * 100)
    
    if price_deviation > 5.0 and net_oi_pct < 5.0:
        return {
            'phase': 'KULMINACIA',
            'description': f'–¶–µ–Ω–∞ —É—à–ª–∞ –Ω–∞ {price_deviation:.1f}%, OI –∑–∞—Ç—É—Ö–∞–µ—Ç ({net_oi_pct:.1f}%)',
            'confidence': 'HIGH'
        }
    elif price_deviation > 3.0 and net_oi_pct > 10.0:
        return {
            'phase': 'IMPULS',
            'description': f'–ê–∫—Ç–∏–≤–Ω—ã–π –Ω–∞–±–æ—Ä: —Ü–µ–Ω–∞ +{price_deviation:.1f}%, OI +{net_oi_pct:.1f}%',
            'confidence': 'HIGH'
        }
    elif price_deviation < 2.0 and abs(net_oi_pct) < 3.0:
        return {
            'phase': 'BALANCE',
            'description': '–ë–æ–∫–æ–≤–∏–∫, –Ω–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è',
            'confidence': 'MEDIUM'
        }
    else:
        return {
            'phase': 'TRANSITION',
            'description': f'–ü–µ—Ä–µ—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: —Ü–µ–Ω–∞ {price_deviation:.1f}%, OI {net_oi_pct:.1f}%',
            'confidence': 'LOW'
        }


def compute_probability(veto: Dict, tam: Dict, anchor: Dict, 
                       metrics: Dict, flow_status: str) -> Dict:
    """
    –†–∞—Å—á—ë—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
    
    –ë–∞–∑–æ–≤–∞—è: 50%
    + –£—Ä–æ–≤–µ–Ω—å 1 (VETO –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç): +15%
    + –£—Ä–æ–≤–µ–Ω—å 2 (OI —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω): +8%
    + –£—Ä–æ–≤–µ–Ω—å 3 (TAM –±–µ–∑ –∞–Ω–æ–º–∞–ª–∏–π): +4%
    + –£—Ä–æ–≤–µ–Ω—å 4 (—Ñ–æ–Ω–æ–≤—ã–µ): +2%
    - –ö–∞–∂–¥–∞—è TAM-–∞–Ω–æ–º–∞–ª–∏—è: -5%
    """
    if flow_status != 'ACTIVE':
        return {
            'direction': None,
            'probability_pct': 0,
            'confidence': 'NONE',
            'breakdown': {'reason': 'Flow invalidated'}
        }
    
    side = anchor.get('side', 'UNKNOWN')
    prob = 50  # –ë–∞–∑–æ–≤–∞—è
    breakdown = {'base': 50}
    
    # –£—Ä–æ–≤–µ–Ω—å 1: VETO
    veto_down = veto.get('down', False)
    veto_up = veto.get('up', False)
    
    if side == 'LONG' and not veto_up:
        prob += 15
        breakdown['level1_veto'] = '+15'
    elif side == 'SHORT' and not veto_down:
        prob += 15
        breakdown['level1_veto'] = '+15'
    else:
        breakdown['level1_veto'] = '0 (blocked)'
    
    # –£—Ä–æ–≤–µ–Ω—å 2: OI —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω
    net_oi_pct = metrics.get('net_oi_pct') or 0
    if (side == 'LONG' and net_oi_pct > 0) or (side == 'SHORT' and net_oi_pct < 0):
        prob += 8
        breakdown['level2_oi'] = '+8'
    else:
        breakdown['level2_oi'] = '0'
    
    # –£—Ä–æ–≤–µ–Ω—å 3: TAM –∞–Ω–æ–º–∞–ª–∏–∏
    tam_count = sum(1 for k, v in tam.items() if k != 'details' and v is True)
    if tam_count == 0:
        prob += 4
        breakdown['level3_tam'] = '+4'
    else:
        penalty = tam_count * 5
        prob -= penalty
        breakdown['level3_tam'] = f'-{penalty}'
    
    # –£—Ä–æ–≤–µ–Ω—å 4: —Ñ–æ–Ω–æ–≤—ã–µ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)
    prob += 2
    breakdown['level4_background'] = '+2'
    
    # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    prob = max(0, min(100, prob))
    
    confidence = 'HIGH' if prob >= 70 else 'MEDIUM' if prob >= 50 else 'LOW'
    
    return {
        # direction = –ø—Ä–æ–≥–Ω–æ–∑ –¥–≤–∏–∂–µ–Ω–∏—è —Ä—ã–Ω–∫–∞ (UP/DOWN/NONE), –ù–ï —Ç–æ—Ä–≥–æ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞!
        # anchor.side = —Ç–æ—Ä–≥–æ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (LONG/SHORT)
        'direction': 'UP' if side == 'LONG' else 'DOWN' if side == 'SHORT' else None,
        'anchor_side': side,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
        'probability_pct': prob,
        'confidence': confidence,
        'breakdown': breakdown
    }
```

---

### 1.9. –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó

```python
def run_full_analysis(symbol: str, exchange: str, start_ts: str, end_ts: str, 
                      limit: int = 500) -> Dict:
    """
    –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–Ω–∞–ª–∏–∑–∞ —è–∫–æ—Ä–Ω–æ–π —Ç–æ—á–∫–∏ + Order Flow.
    
    –ö–†–ò–¢–ò–ß–ù–û: 
    - exchange –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω (binance/bybit)
    - –≤—Å–µ —Ä–∞—Å—á—ë—Ç—ã –¥–µ–ª–∞—é—Ç—Å—è –Ω–∞ —Å–≤–µ—á–∞—Ö –û–î–ù–û–ì–û final_tf
    - —Å–º–µ—à–∏–≤–∞–Ω–∏–µ TF —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è final_tf
    
    Args:
        symbol: –¢–∏–∫–µ—Ä ('ETHUSDT', 'BTCUSDT')
        exchange: –ë–∏—Ä–∂–∞ ('binance', 'bybit') ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
        start_ts: –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ (ISO8601 UTC)
        end_ts: –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (ISO8601 UTC)
        limit: –ú–∞–∫—Å–∏–º—É–º —Å–≤–µ—á–µ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 500+ –¥–ª—è —Å–º–µ—à–∞–Ω–Ω—ã—Ö TF)
    
    Returns:
        JSON-–æ—Ç—á—ë—Ç –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ AI-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä—É
    """
    # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –í–°–ï–• –¥–∞–Ω–Ω—ã—Ö (—Å–º–µ—à–∞–Ω–Ω—ã–µ TF)
    candles_all = fetch_candles(symbol, exchange, start_ts, end_ts, limit)
    
    if not candles_all:
        return {'error': '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞'}
    
    # 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π TF (D1 –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å H4)
    final_info = _pick_final_tf(candles_all)
    final_tf = _normalize_tf(final_info['final_tf'] or 'H4')
    
    # 3. –ö–†–ò–¢–ò–ß–ù–û: –§–∏–ª—å—Ç—Ä—É–µ–º —Å–≤–µ—á–∏ –ø–æ final_tf
    #    –í—Å–µ –¥–∞–ª—å–Ω–µ–π—à–∏–µ —Ä–∞—Å—á—ë—Ç—ã ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–º TF!
    candles = _filter_by_tf(candles_all, final_tf)
    
    if not candles or len(candles) < 10:
        return {
            'error': f'–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è final_tf={final_tf}',
            'total_candles_all': len(candles_all),
            'total_candles_final_tf': len(candles)
        }
    
    # 4. –ü–æ–∏—Å–∫ —è–∫–æ—Ä—è (–Ω–∞ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–≤–µ—á–∞—Ö!)
    candidates = scan_candidates(candles)
    anchor = select_anchor(candidates, candles)
    
    if not anchor:
        return {
            'error': '–í–∞–ª–∏–¥–Ω—ã–π —è–∫–æ—Ä—å –Ω–µ –Ω–∞–π–¥–µ–Ω',
            'candidates_count': len(candidates)
        }
    
    # 5. –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–º
    t_struct = find_structural_break(candles, anchor, final_tf)
    t_flow = t_struct if t_struct is not None else anchor['index']
    
    # 6. –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ—Ç–æ–∫–∞
    t_current = len(candles) - 1
    metrics = calculate_flow_metrics(candles, t_flow, t_current)
    
    # 7. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞
    invalidation = check_flow_invalidation(candles, anchor, t_flow, final_tf)
    
    # 8. VETO-—Ñ–∏–ª—å—Ç—Ä—ã
    core = V3_Deterministic_Core(final_tf)
    veto_result = core.run_analysis(candles)
    
    # 9. TAM –∞–Ω–æ–º–∞–ª–∏–∏
    baseline = compute_baseline(candles)
    tam = detect_tam_anomalies(candles[-1], baseline, final_tf)
    
    # 10. –§–∞–∑–∞ —Ä—ã–Ω–∫–∞ (Python —Å—á–∏—Ç–∞–µ—Ç!)
    phase = compute_phase(anchor, metrics, invalidation['status'])
    
    # 11. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (Python —Å—á–∏—Ç–∞–µ—Ç!)
    probability = compute_probability(
        veto=veto_result.get('veto', {}),
        tam=tam,
        anchor=anchor,
        metrics=metrics,
        flow_status=invalidation['status']
    )
    
    # 12. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ JSON-–æ—Ç—á—ë—Ç–∞
    report = {
        'metadata': {
            'symbol': symbol,
            'start_ts': start_ts,
            'end_ts': end_ts,
            'final_tf': final_tf,
            'final_ts': final_info['final_ts'],
            'timestamp': candles[-1]['ts'],
            'total_candles_all': len(candles_all),
            'total_candles_final_tf': len(candles)
        },
        'anchor': {
            'index': anchor['index'],
            'type': anchor['type'],
            'side': anchor['side'],
            'price': anchor['price'],
            'timestamp': anchor['timestamp'],
            'tf': final_tf
        },
        'flow': {
            'start_index': t_flow,
            'start_timestamp': candles[t_flow]['ts'],
            'status': invalidation['status'],
            'invalidation_reason': invalidation['reason'],
            'length': t_current - t_flow + 1  # –ö–æ–ª-–≤–æ —Å–≤–µ—á–µ–π –≤ –ø–æ—Ç–æ–∫–µ (AI –Ω–µ —Å—á–∏—Ç–∞–µ—Ç!)
        },
        'phase': phase,
        'probability': probability,
        'metrics': metrics,
        'veto': veto_result.get('veto', {}),
        'efficiency': {
            'er': veto_result.get('er'),
            'sr': veto_result.get('sr'),
            'oe': veto_result.get('oe')
        },
        'tam_anomalies': {
            **tam,
            'count': sum(1 for k, v in tam.items() if k != 'details' and v is True)
        },
        'last_candle': {
            **candles[-1],
            # –î–æ–±–∞–≤–ª—è–µ–º sign –ø–æ–ª—è —á—Ç–æ–±—ã AI –Ω–µ —Å—á–∏—Ç–∞–ª
            'cvd_sign': 1 if (candles[-1].get('cvd_pct') or 0) > 0 else -1 if (candles[-1].get('cvd_pct') or 0) < 0 else 0,
            'doi_sign': 1 if (candles[-1].get('doi_pct') or 0) > 0 else -1 if (candles[-1].get('doi_pct') or 0) < 0 else 0
        }
    }
    
    return report
```

---

## üß† –ß–ê–°–¢–¨ 2: AI INTERPRETER (–ò–ù–¢–ï–†–ü–†–ï–¢–ê–¶–ò–Ø)

**–ó–∞–¥–∞—á–∞ AI:** –ü–æ–ª—É—á–∏—Ç—å JSON –æ—Ç Python ‚Üí –°–¥–µ–ª–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π –æ—Ç—á—ë—Ç

### 2.1. –í–•–û–î–ù–û–ô JSON

```json
{
  "metadata": {
    "symbol": "ETHUSDT",
    "start_ts": "2026-01-01T00:00:00Z",
    "end_ts": "2026-02-03T23:59:59Z",
    "final_tf": "H4",
    "final_ts": "2026-02-03T08:00:00Z",
    "timestamp": "2026-02-03T10:00:00Z",
    "total_candles_all": 450,
    "total_candles_final_tf": 120
  },
  "anchor": {
    "index": 52,
    "type": "B",
    "side": "SHORT",
    "price": 45000,
    "timestamp": "2026-02-01T08:00:00Z",
    "tf": "H4"
  },
  "flow": {
    "start_index": 35,
    "start_timestamp": "2026-01-31T20:00:00Z",
    "status": "ACTIVE",
    "invalidation_reason": null,
    "length": 85
  },
  "phase": {
    "phase": "IMPULS",
    "description": "–ê–∫—Ç–∏–≤–Ω—ã–π –Ω–∞–±–æ—Ä: —Ü–µ–Ω–∞ +2.2%, OI +12.5%",
    "confidence": "HIGH"
  },
  "probability": {
    "direction": "DOWN",
    "anchor_side": "SHORT",
    "probability_pct": 79,
    "confidence": "HIGH",
    "breakdown": {
      "base": 50,
      "level1_veto": "+15",
      "level2_oi": "+8",
      "level3_tam": "-4",
      "level4_background": "+2"
    }
  },
  "metrics": {
    "net_oi": 125000,
    "net_oi_pct": 12.5,
    "cum_cvd": 45.3,
    "avg_entry": 44500,
    "current_price": 46000,
    "pl_percent": 3.37
  },
  "veto": {
    "down": false,
    "up": false,
    "reasons": []
  },
  "efficiency": {
    "er": 1.8,
    "sr": 0.65,
    "oe": 2.3
  },
  "tam_anomalies": {
    "friction": false,
    "skew": false,
    "fuel_inversion": true,
    "quality": false,
    "crowding": false,
    "vacuum": false,
    "hollow": false,
    "count": 1,
    "details": {
      "fuel_inversion": "price_sign=-1, limb_pct=+15% (–ª–∏–∫–≤–∏–¥–∞—Ü–∏–π —à–æ—Ä—Ç–æ–≤ –±–æ–ª—å—à–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏)"
    }
  },
  "last_candle": {
    "ts": "2026-02-03T08:00:00Z",
    "tf": "H4",
    "open": 45800,
    "high": 46200,
    "low": 45600,
    "close": 46000,
    "cvd_pct": 8.5,
    "cvd_sign": 1,
    "doi_pct": 1.2,
    "doi_sign": 1,
    "oi_change": 5000,
    "oi_total": 1000000,
    "price_sign": 1,
    "body_pct": 65,
    "clv_pct": 75,
    "liq_long": 150000,
    "liq_short": 50000
  }
}
```

---

### 2.2. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –û–¢–ß–Å–¢–ê

#### 2.2.1. –ë–õ–û–ö: –Ø–ö–û–†–ù–ê–Ø –¢–û–ß–ö–ê –ò –ü–û–¢–û–ö

```markdown
## üéØ –Ø–ö–û–†–ù–ê–Ø –¢–û–ß–ö–ê –ò –ü–û–¢–û–ö

**–Ø–ö–û–†–¨ (T0):**
- –°–≤–µ—á–∞: #52 (2026-02-01 08:00 UTC)
- –¢–∏–ø —Å–æ–±—ã—Ç–∏—è: TYPE B (–ü—Ä–æ–±–æ–π —Å –æ—Ç–∫–∞—Ç–æ–º)
- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: SHORT (–æ–∂–∏–¥–∞–µ–º –ø–∞–¥–µ–Ω–∏–µ)
- –¶–µ–Ω–∞ —è–∫–æ—Ä—è: 45000
- –°—Ç–∞—Ç—É—Å: ‚úÖ –í–ê–õ–ò–î–ï–ù

**–ù–ê–ß–ê–õ–û –ü–û–¢–û–ö–ê (T_flow):**
- –°–≤–µ—á–∞: #35 (2026-01-31 20:00 UTC)
- –ü—Ä–∏—á–∏–Ω–∞: –ù–∞–π–¥–µ–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–º (Bearish Break) –†–ê–ù–¨–®–ï —è–∫–æ—Ä—è
- –ü–æ—Ç–æ–∫ —É—á–∏—Ç—ã–≤–∞–µ—Ç: {flow.length} —Å–≤–µ—á–µ–π –æ—Ç —Å–ª–æ–º–∞ –¥–æ —Ç–µ–∫—É—â–µ–π

**–°–¢–ê–¢–£–° –ü–û–¢–û–ö–ê:**
- ‚úÖ –ê–ö–¢–ò–í–ù–´–ô
- Net OI: +12.5% (–ø–æ–∑–∏—Ü–∏–∏ –Ω–∞–±–∏—Ä–∞—é—Ç—Å—è)
- Cum CVD: +45.3% (–¥–æ–º–∏–Ω–∏—Ä—É—é—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏)
- Avg Entry: 44500 (—Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞)
- –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: 46000
- P&L –ø–æ–∑–∏—Ü–∏–π: +3.4% (—É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤ –ø–ª—é—Å–µ)

**–ü–†–û–í–ï–†–ö–ê –ò–ù–í–ê–õ–ò–î–ê–¶–ò–ò:**
- –û–±—Ä–∞—Ç–Ω—ã–π —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–º: ‚ùå –ù–ï–¢
- Net OI –æ–±–Ω—É–ª–∏–ª—Å—è: ‚ùå –ù–ï–¢
- –í—ã–≤–æ–¥: –ü–æ—Ç–æ–∫ –∂–∏–≤, —Ç—Ä–µ–Ω–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
```

#### 2.2.2. –ë–õ–û–ö: –§–ê–ó–ê –†–´–ù–ö–ê

**‚ö†Ô∏è –í–ê–ñ–ù–û: AI –ù–ï –í–´–ß–ò–°–õ–Ø–ï–¢ –§–ê–ó–£. –§–∞–∑–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≥–æ—Ç–æ–≤–∞—è –∏–∑ JSON (report.phase).**

**–ü—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ `phase.phase` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ null ‚Üí –ø–∏—Å–∞—Ç—å `[UNKNOWN]`.

**–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ!):**

```markdown
## üìä –§–ê–ó–ê –†–´–ù–ö–ê

**–§–ê–ó–ê:** {phase.phase} {emoji}

**–û–ü–ò–°–ê–ù–ò–ï:** {phase.description}

**–£–í–ï–†–ï–ù–ù–û–°–¢–¨:** {phase.confidence}
```

**Emoji –ø–æ —Ñ–∞–∑–∞–º:**
- IMPULS ‚Üí üöÄ
- KULMINACIA ‚Üí ‚ö°
- BALANCE ‚Üí ‚öñÔ∏è
- TRANSITION ‚Üí üîÑ
- INVALIDATED ‚Üí ‚ùå
- UNKNOWN ‚Üí ‚ùì

#### 2.2.3. –ë–õ–û–ö: VETO –ò –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨

**‚ö†Ô∏è –ü–†–ê–í–ò–õ–û:** –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –†–ï–ê–õ–¨–ù–û –µ—Å—Ç—å –≤ JSON:  
- `veto.up`, `veto.down`, `veto.reasons`  
- `efficiency.er`, `efficiency.sr`, `efficiency.oe`

**–ò–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Ä–∞–∑–¥–µ–ª 8.1:**

```markdown
## üö´ VETO-–§–ò–õ–¨–¢–†–´

**–ò–¢–û–ì VETO:**
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UP: {veto.up ? "üî¥ –î–ê" : "üü¢ –ù–ï–¢"}
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ DOWN: {veto.down ? "üî¥ –î–ê" : "üü¢ –ù–ï–¢"}
- –ü—Ä–∏—á–∏–Ω—ã: {veto.reasons –∏–ª–∏ "–Ω–µ—Ç"}

**–≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨ (–∏–∑ JSON):**
- ER = {efficiency.er} (–ø–æ—Ä–æ–≥ 0.1)
- SR = {efficiency.sr} (–ø–æ—Ä–æ–≥ 0.5)
- OE = {efficiency.oe}

**–í–´–í–û–î VETO:** {veto.up || veto.down ? "üî¥ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û" : "üü¢ –ù–ï –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û"}
–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: {probability.direction}
```

#### 2.2.4. –ë–õ–û–ö: TAM-V3.3 –ê–ù–û–ú–ê–õ–ò–ò

**‚ö†Ô∏è –ü–†–ê–í–ò–õ–û:** AI –¢–û–õ–¨–ö–û –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `tam_anomalies.*`.  
–ï—Å–ª–∏ —Ñ–ª–∞–≥ `true` ‚Üí –ø–∏—à–µ–º "‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù", –µ—Å–ª–∏ `false` ‚Üí "‚ùå –ù–ï–¢".

**–ò–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Ä–∞–∑–¥–µ–ª 12:**

```markdown
## ‚ö†Ô∏è –†–ò–°–ö–ò –ò –ú–ê–ù–ò–ü–£–õ–Ø–¶–ò–ò (TAM-V3.3)

**FRICTION:** {tam_anomalies.friction ? "‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù" : "‚ùå –ù–ï–¢"}
**SKEW:** {tam_anomalies.skew ? "‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù" : "‚ùå –ù–ï–¢"}
**FUEL INVERSION:** {tam_anomalies.fuel_inversion ? "‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù" : "‚ùå –ù–ï–¢"}
**QUALITY:** {tam_anomalies.quality ? "‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù" : "‚ùå –ù–ï–¢"}
**CROWDING:** {tam_anomalies.crowding ? "‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù" : "‚ùå –ù–ï–¢"}
**VACUUM:** {tam_anomalies.vacuum ? "‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù" : "‚ùå –ù–ï–¢"}
**HOLLOW:** {tam_anomalies.hollow ? "‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù" : "‚ùå –ù–ï–¢"}

**–î–ï–¢–ê–õ–ò:** {tam_anomalies.details}

**–í–´–í–û–î TAM:** {tam_anomalies.count} –∞–Ω–æ–º–∞–ª–∏–π –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ.
```

#### 2.2.5. –ë–õ–û–ö: –°–ò–ù–¢–ï–ó –£–†–û–í–ù–ï–ô (1-4)

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –°–∏–Ω—Ç–µ–∑ —É—Ä–æ–≤–Ω–µ–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã** –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–≤–µ—á–∏.  
**–ò–¢–û–ì–û–í–û–ï –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï** –±–µ—Ä—ë—Ç—Å—è –¢–û–õ–¨–ö–û –∏–∑ `probability.direction` (–≤—ã—á–∏—Å–ª–µ–Ω–æ Python).

**–ò–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Ä–∞–∑–¥–µ–ª—ã 5-6:**

```markdown
## üéØ –°–ò–ù–¢–ï–ó –°–ò–ì–ù–ê–õ–û–í (4 –£–†–û–í–ù–Ø)

**–£–†–û–í–ï–ù–¨ 1 (–ö–†–ò–¢–ò–ß–ù–´–ï):**
- Price_Sign: {last_candle.price_sign}
- Price_vs_Delta: {match/divergence}
- CVD%: {last_candle.cvd_pct}%
- –í–´–í–û–î –£–†–û–í–ù–Ø: {–ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª}

**–£–†–û–í–ï–ù–¨ 2 (–í–ê–ñ–ù–´–ï):**
- DOI%: {last_candle.doi_pct}%
- Limb%: {last_candle.limb_pct}%
- Liq_imbalance: {liq_short > liq_long ?}
- –í–´–í–û–î –£–†–û–í–ù–Ø: {–ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª}

**–£–†–û–í–ï–ù–¨ 3 (–í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï):**
- Body%: {last_candle.body_pct}%
- CLV%: {last_candle.clv_pct}%
- –í–´–í–û–î –£–†–û–í–ù–Ø: {–ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª}

**–£–†–û–í–ï–ù–¨ 4 (–§–û–ù–û–í–´–ï):**
- Range%: {above/below average}
- Tilt%: {last_candle.tilt_pct}%
- –í–´–í–û–î –£–†–û–í–ù–Ø: {–ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª}

**–ö–û–ù–§–õ–ò–ö–¢–´:** {–µ—Å—Ç—å/–Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏}

**–†–ê–°–ß–Å–¢ –í–ï–†–û–Ø–¢–ù–û–°–¢–ò (–∏–∑ JSON):**
{probability.breakdown}

**–ò–¢–û–ì–û–í–û–ï –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï:** {probability.direction} {probability.probability_pct}%
```

#### 2.2.6. –ë–õ–û–ö: –ü–û–ß–ï–ú–£ –Ø –ú–û–ì–£ –û–®–ò–ë–ê–¢–¨–°–Ø

**–ò–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Ä–∞–∑–¥–µ–ª 8.13 ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!**

```markdown
## üîç –ü–û–ß–ï–ú–£ –Ø –ú–û–ì–£ –û–®–ò–ë–ê–¢–¨–°–Ø

1. **FUEL INVERSION:** –†–æ—Å—Ç –Ω–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏—è—Ö —à–æ—Ä—Ç–æ–≤ ‚Äî —Ç–æ–ø–ª–∏–≤–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ
2. **–Ø–∫–æ—Ä—å SHORT, –∞ —Ü–µ–Ω–∞ —Ä–∞—Å—Ç—ë—Ç:** –í–æ–∑–º–æ–∂–Ω–æ —è–∫–æ—Ä—å —É–∂–µ –Ω–µ –∞–∫—Ç—É–∞–ª–µ–Ω, –∂–¥—ë–º –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
3. **P&L +3.4%:** –ü–æ–∑–∏—Ü–∏–∏ –≤ –ø–ª—é—Å–µ, —Ä–∏—Å–∫ —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä—É–ø–Ω–æ–≥–æ DOI:** +1.2% ‚Äî —Å–ª–∞–±—ã–π –Ω–∞–±–æ—Ä, –Ω–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∫—Ä—É–ø–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
```

#### 2.2.7. –ë–õ–û–ö: –ü–õ–ê–ù –¢–û–†–ì–û–í–õ–ò

**–ò–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Ä–∞–∑–¥–µ–ª 13 ‚Äî –¥–æ—Å–ª–æ–≤–Ω–æ!**

```markdown
## üìà –ü–õ–ê–ù –¢–û–†–ì–û–í–õ–ò

**–ì–õ–û–ë–ê–õ–¨–ù–û (1D):**
- –ó–æ–Ω–∞ –≤—Ö–æ–¥–∞: 45000-45500 (—è–∫–æ—Ä—å + —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–º)
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è: –ó–∞–∫—Ä—ã—Ç–∏–µ –¥–Ω—è –Ω–∏–∂–µ 44200 (low —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Å–ª–æ–º–∞)
- –¶–µ–ª—å: 47500 (—Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è)

**–õ–û–ö–ê–õ–¨–ù–û (H4):**

**–°—Ü–µ–Ω–∞—Ä–∏–π 1 (–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π):**
- –í—Ö–æ–¥: 46000 (—Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞) –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ DOI > 0.8% –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å–≤–µ—á–µ
- –°—Ç–æ–ø: 45400 (–ø–æ–¥ –æ—Ç–∫–∞—Ç –∫ —è–∫–æ—Ä—é)
- –†–∏—Å–∫: Fuel Inversion ‚Äî –≤–æ–∑–º–æ–∂–µ–Ω –æ—Ç–∫–∞—Ç

**–°—Ü–µ–Ω–∞—Ä–∏–π 2 (–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π):**
- –í—Ö–æ–¥: 45500 (–æ—Ç–∫–∞—Ç –∫ —è–∫–æ—Ä—é) –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ Net OI –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞—Å—Ç–∏
- –°—Ç–æ–ø: 44900 (–ø–æ–¥ low —è–∫–æ—Ä—è)
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: CVD% > 5% –Ω–∞ –æ—Ç–∫–∞—Ç–µ –≤–Ω–∏–∑

**–ò–ù–í–ê–õ–ò–î–ê–¶–ò–Ø:**
- –ó–∞–∫—Ä—ã—Ç–∏–µ H4 —Å–≤–µ—á–∏ –Ω–∏–∂–µ 44500 (–ø—Ä–æ–±–æ–π —è–∫–æ—Ä—è)

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –†–ò–°–ö–ò:**
1. **Fuel Inversion:** –¢–æ–ø–ª–∏–≤–æ –∏—Å—Ç–æ—â–∞–µ—Ç—Å—è, –≤–æ–∑–º–æ–∂–µ–Ω —Ä–µ–∑–∫–∏–π –æ—Ç–∫–∞—Ç
2. **–Ø–∫–æ—Ä—å SHORT:** –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ —Å —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–æ–π, –∂–¥—ë–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —è–∫–æ—Ä—è
3. **Crowd Exit:** –ü—Ä–∏ P&L > 5% —Ä–∏—Å–∫ –º–∞—Å—Å–æ–≤–æ–π —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏
```

---

### 2.3. –§–û–†–ú–ê–¢ –ò–¢–û–ì–û–í–û–ì–û –†–ï–ó–Æ–ú–ï

```markdown
## üìã –ò–¢–û–ì–û–í–û–ï –†–ï–ó–Æ–ú–ï

**BTCUSDT H4 | 03.02.2026 10:00 UTC**

**–Ø–ö–û–†–¨:** #52 (TYPE B, SHORT, 45000) ‚Äî –í–ê–õ–ò–î–ï–ù  
**–ü–û–¢–û–ö:** –° #35 (—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–º) ‚Äî –ê–ö–¢–ò–í–ù–´–ô (+12.5% Net OI)  
**–§–ê–ó–ê:** –ò–ú–ü–£–õ–¨–° üöÄ (—Ç—Ä–µ–Ω–¥ –º–æ–ª–æ–¥–æ–π, –∏–¥—ë—Ç –Ω–∞–±–æ—Ä)  

**–ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï:** {probability.direction} {probability.probability_pct}%  
**VETO:** üü¢ –ù–ï –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û  
**–ê–ù–û–ú–ê–õ–ò–ò:** ‚ö†Ô∏è FUEL INVERSION (—Ä–æ—Å—Ç –Ω–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏—è—Ö —à–æ—Ä—Ç–æ–≤)

**–í–•–û–î:** 46000 (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ) | 45500 (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)  
**–°–¢–û–ü:** 45400 | 44900  
**–¶–ï–õ–¨:** 47500  

**–ì–õ–ê–í–ù–´–ô –†–ò–°–ö:** –ò—Å—Ç–æ—â–µ–Ω–∏–µ —Ç–æ–ø–ª–∏–≤–∞ (–ª–∏–∫–≤–∏–¥–∞—Ü–∏–π —à–æ—Ä—Ç–æ–≤). –°–ª–µ–¥–∏—Ç—å –∑–∞ DOI –∏ Net OI –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–≤–µ—á–∞—Ö.
```

---

## üìö –°–û–•–†–ê–ù–Å–ù–ù–´–ï –†–ê–ó–î–ï–õ–´ –ò–ó –°–¢–ê–†–û–ì–û –ü–†–û–ú–ü–¢–ê

**–°–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã –û–°–¢–ê–Æ–¢–°–Ø –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è AI –ø—Ä–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏:**

### ‚úÖ –°–û–•–†–ê–ù–ï–ù–û –î–û–°–õ–û–í–ù–û:

- **–†–∞–∑–¥–µ–ª 0:** –†–µ–∂–∏–º –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (ALWAYS-ON)
- **–†–∞–∑–¥–µ–ª 2:** –ñ—ë—Å—Ç–∫–∏–µ –∑–∞–ø—Ä–µ—Ç—ã (ZERO TOLERANCE)
- **–†–∞–∑–¥–µ–ª 4:** –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
- **–†–∞–∑–¥–µ–ª 8:** –ï–¥–∏–Ω—ã–π —Å–≤–æ–¥ –ø—Ä–∞–≤–∏–ª (V3.4)
  - 8.2: –ó–æ–ª–æ—Ç—ã–µ –∑–∞–∫–æ–Ω—ã –∏—Å—Ç–∏–Ω—ã
  - 8.3: –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –º–µ—Ö–∞–Ω–∏–∫–∏
  - 8.4: –ú–∞—Ç—Ä–∏—Ü–∞ –∞–Ω–æ–º–∞–ª–∏–π (TAM-V3.3)
  - 8.5: ONLINE-–∫–æ–º–∞–Ω–¥—ã –¥–µ—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–∏
  - 8.6: –ò—Ç–æ–≥–æ–≤–∞—è –º–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
  - 8.7: –ö–æ–Ω—Ç–µ–∫—Å—Ç —É—á–∞—Å—Ç–∫–∞: —Å–∏–Ω—Ç–µ–∑ D1 + H4
  - 8.8-8.12: –í—Å–µ –∞–Ω—Ç–∏–æ—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
  - 8.13: –ñ—ë—Å—Ç–∫–∏–µ –∑–∞–ø—Ä–µ—Ç—ã –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–†–∞–∑–¥–µ–ª 9:** –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ—Ä–æ–≥–æ–≤ ORDER FLOW V3
- **–†–∞–∑–¥–µ–ª 10:** UTA-V2.1 (–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ê–ª–≥–æ—Ä–∏—Ç–º –ò—Å—Ç–∏–Ω—ã)
- **–†–∞–∑–¥–µ–ª 11:** –§–æ—Ä–º–∞ –≤—ã–≤–æ–¥–∞ –æ—Ç—á—ë—Ç–∞ (–ê–î–ò-V3.5)
- **–†–∞–∑–¥–µ–ª 12:** –†–∏—Å–∫–∏ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ (5 —Ñ–∏–ª—å—Ç—Ä–æ–≤ TAM)
- **–†–∞–∑–¥–µ–ª 13:** –ü–ª–∞–Ω —Ç–æ—Ä–≥–æ–≤–ª–∏ (V3.7 OMNISCIENT)

---

## üîß –£–ë–†–ê–ù–û –ò–ó –°–¢–ê–†–û–ì–û –ü–†–û–ú–ü–¢–ê:

### ‚ùå –£–î–ê–õ–ï–ù–û (—Ç–µ–ø–µ—Ä—å –≤ Python):

- **–†–∞–∑–¥–µ–ª 3.1:** –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (47 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤) ‚Äî —Ç–µ–ø–µ—Ä—å Supabase
- **–†–∞–∑–¥–µ–ª 3.2:** –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ ‚Äî —Ç–µ–ø–µ—Ä—å –≤ Python
- **–†–∞–∑–¥–µ–ª 3.3:** –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º—É ‚Äî —Ç–µ–ø–µ—Ä—å SQL –∑–∞–ø—Ä–æ—Å
- **–°–¢–ê–î–ò–Ø 2:** –§–æ–Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (BASELINE) ‚Äî Python —Å—á–∏—Ç–∞–µ—Ç
- **–°–¢–ê–î–ò–Ø 3:** –ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è ‚Äî Python –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä—É–µ—Ç
- **–†–∞–∑–¥–µ–ª 6:** –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (PYTHON!) ‚Äî Python —Å—á–∏—Ç–∞–µ—Ç
- **–†–∞–∑–¥–µ–ª 8.1:** CORE-ENGINE ‚Äî –≤–µ—Å—å –∫–æ–¥ –≤ Python

---

## üéØ –§–ò–ù–ê–õ–¨–ù–´–ô WORKFLOW

```
1. Python CORE ENGINE –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
   ‚îú‚îÄ –ü–æ–ª—É—á–∞–µ—Ç —Å–≤–µ—á–∏ –∏–∑ Supabase
   ‚îú‚îÄ –ò—â–µ—Ç —è–∫–æ—Ä—å (SCAN ‚Üí SELECT)
   ‚îú‚îÄ –ò—â–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–º (STRUCTURAL OVERRIDE)
   ‚îú‚îÄ –°—á–∏—Ç–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ—Ç–æ–∫–∞ (Net OI, CVD, Avg Entry)
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é (STRUCT BREAK, OI RESET)
   ‚îú‚îÄ –ó–∞–ø—É—Å–∫–∞–µ—Ç VETO-—Ñ–∏–ª—å—Ç—Ä—ã (WALL/ER/SR/GR1)
   ‚îú‚îÄ –ó–∞–ø—É—Å–∫–∞–µ—Ç TAM-V3.3 (7 —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∞–Ω–æ–º–∞–ª–∏–π)
   ‚îî‚îÄ –§–æ—Ä–º–∏—Ä—É–µ—Ç JSON-–æ—Ç—á—ë—Ç

2. JSON –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è AI:
   ‚îú‚îÄ AI —á–∏—Ç–∞–µ—Ç JSON
   ‚îú‚îÄ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –°–û–•–†–ê–ù–Å–ù–ù–´–ï –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
   ‚îú‚îÄ –û–¢–û–ë–†–ê–ñ–ê–ï–¢ —Ñ–∞–∑—É –∏–∑ JSON (report.phase) ‚ö†Ô∏è –ù–ï –í–´–ß–ò–°–õ–Ø–ï–¢!
   ‚îú‚îÄ –û–¢–û–ë–†–ê–ñ–ê–ï–¢ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∏–∑ JSON (report.probability) ‚ö†Ô∏è –ù–ï –í–´–ß–ò–°–õ–Ø–ï–¢!
   ‚îú‚îÄ –§–æ—Ä–º–∏—Ä—É–µ—Ç —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π –æ—Ç—á—ë—Ç
   ‚îî‚îÄ –î–æ–±–∞–≤–ª—è–µ—Ç –ø–ª–∞–Ω —Ç–æ—Ä–≥–æ–≤–ª–∏

3. –û—Ç—á—ë—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

---

## üìå –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

### –î–õ–Ø PYTHON:
2. **Supabase ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –Ω–µ –ø–∞—Ä—Å–∏–º X-Ray
3. **JSON —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω** ‚Äî AI –Ω–µ –¥–æ–¥—É–º—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
4. **VETO –∏ TAM –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã** ‚Äî AI –ø–æ–ª—É—á–∞–µ—Ç —É–∂–µ –≥–æ—Ç–æ–≤—ã–µ —Ñ–ª–∞–≥–∏

### –î–õ–Ø AI:
1. **–¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è** ‚Äî –Ω–µ —Å—á–∏—Ç–∞–µ—Ç, —Ç–æ–ª—å–∫–æ –æ–±—ä—è—Å–Ω—è–µ—Ç
2. **–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã** ‚Äî —Ä–∞–∑–¥–µ–ª—ã 0, 2, 4, 8-13
3. **–§–æ—Ä–º–∞—Ç –æ—Ç—á—ë—Ç–∞ —Å—Ç—Ä–æ–≥–∏–π** ‚Äî –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏
4. **–Ø–∫–æ—Ä—å –∏ –ø–æ—Ç–æ–∫ –≤ –Ω–∞—á–∞–ª–µ** ‚Äî —ç—Ç–æ —Ç–µ–ø–µ—Ä—å —Ü–µ–Ω—Ç—Ä –∞–Ω–∞–ª–∏–∑–∞

```

### AI Prompt:
```
–¢—ã –ø–æ–ª—É—á–∏–ª JSON-–æ—Ç—á—ë—Ç –æ—Ç Python CORE ENGINE.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ —Å–æ–∑–¥–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π –æ—Ç—á—ë—Ç.

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ë–õ–û–ö–ò:
1. –Ø–∫–æ—Ä–Ω–∞—è —Ç–æ—á–∫–∞ –∏ –ø–æ—Ç–æ–∫
2. –§–∞–∑–∞ —Ä—ã–Ω–∫–∞
3. VETO-—Ñ–∏–ª—å—Ç—Ä—ã
4. TAM-V3.3 –∞–Ω–æ–º–∞–ª–∏–∏
5. –°–∏–Ω—Ç–µ–∑ —É—Ä–æ–≤–Ω–µ–π (1-4)
6. –ü–æ—á–µ–º—É —è –º–æ–≥—É –æ—à–∏–±–∞—Ç—å—Å—è
7. –ü–ª–∞–Ω —Ç–æ—Ä–≥–æ–≤–ª–∏
8. –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ

–ü—Ä–∏–º–µ–Ω—è–π –í–°–ï –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤ 0, 2, 4, 8-13 —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞.
–ù–ï —Å—á–∏—Ç–∞–π –Ω–∏—á–µ–≥–æ —Å–∞–º ‚Äî —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–π –≥–æ—Ç–æ–≤—ã–µ —Ü–∏—Ñ—Ä—ã.

JSON-–æ—Ç—á—ë—Ç:
{–æ—Ç—á—ë—Ç}
```



